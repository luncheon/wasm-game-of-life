var $="./wasm_game_of_life_bg.wasm";var AA=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder,B=new AA("utf-8",{ignoreBOM:!0,fatal:!0});B.decode();var v=null;function eA(){return(v===null||v.buffer!==p.buffer)&&(v=new Uint8Array(p.buffer)),v}function tA(e,A){return B.decode(eA().subarray(e,e+A))}var u=class{static __wrap(A){let t=Object.create(u.prototype);return t.ptr=A,t}__destroy_into_raw(){let A=this.ptr;return this.ptr=0,A}free(){let A=this.__destroy_into_raw();F(A)}constructor(A,t){var r=D(A,t);return u.__wrap(r)}random(){K(this.ptr)}single_space_ship(A,t){M(this.ptr,A,t)}get as_ptr(){var A=O(this.ptr);return A}get cells_ptr(){var A=L(this.ptr);return A}get row_count(){var A=R(this.ptr);return A>>>0}get column_count(){var A=T(this.ptr);return A>>>0}tick(){S(this.ptr)}},_=class{static __wrap(A){let t=Object.create(_.prototype);return t.ptr=A,t}__destroy_into_raw(){let A=this.ptr;return this.ptr=0,A}free(){let A=this.__destroy_into_raw();G(A)}constructor(A,t,r,n,a){var j=H(A,t,r,n,a);return _.__wrap(j)}get width(){var A=N(this.ptr);return A>>>0}get height(){var A=U(this.ptr);return A>>>0}get data_ptr(){var A=W(this.ptr);return A}draw_cells(A){V(this.ptr,A)}};function I(){var e=Date.now();return e}function C(e,A){throw new Error(tA(e,A))}var nA={["./wasm_game_of_life_bg.js"]:{__wbg_now_c3277d0b8a8f625b:I,__wbindgen_throw:C}};async function aA(e,A){if(typeof e=="string"){let t=await fetch(e);if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,A)}catch(r){if(t.headers.get("Content-Type")!="application/wasm")console.warn(r);else throw r}e=await t.arrayBuffer()}return await WebAssembly.instantiate(e,A)}var{instance:s,module:dA}=await aA($,nA),p=s.exports.memory,F=s.exports.__wbg_universe_free,D=s.exports.universe_new,K=s.exports.universe_random,M=s.exports.universe_single_space_ship,O=s.exports.universe_as_ptr,L=s.exports.universe_cells_ptr,R=s.exports.universe_row_count,T=s.exports.universe_column_count,S=s.exports.universe_tick,G=s.exports.__wbg_universecanvasdrawer_free,H=s.exports.universecanvasdrawer_new,N=s.exports.universecanvasdrawer_width,U=s.exports.universecanvasdrawer_height,W=s.exports.universecanvasdrawer_data_ptr,V=s.exports.universecanvasdrawer_draw_cells;var i=document.body.appendChild(document.createElement("aside"));i.style.position="fixed";i.style.top="16px";i.style.right="16px";i.style.padding="4px";i.style.background="rgba(255,255,255,.8)";i.style.whiteSpace="nowrap";i.style.userSelect="none";var m=3,o=m+1,Z=[204,204,204],f=[255,255,255],E=[0,0,0],J=([e,A,t])=>`rgb(${e},${A},${t})`,w=([e,A,t])=>(255<<24)+(t<<16)+(A<<8)+e,sA=(()=>{let e=i.appendChild(document.createElement("div"));e.style.float="right",e.style.color="hsl(150,100%,50%)",e.style.textShadow="1px 1px 1px hsl(150,100%,20%)",e.style.fontVariantNumeric="tabular-nums",e.textContent="0 fps";let A=0,t=performance.now();return setInterval(()=>{let r=performance.now();e.textContent=`${Math.round(A*1e3/(r-t))} fps`,A=0,t=r},512),()=>A++})(),y=e=>{let A,t=()=>{e(),sA(),A=requestAnimationFrame(t)};return t(),{stop:()=>A!==void 0&&cancelAnimationFrame(A)}},b=(e,A,t)=>{let{row_count:r,column_count:n}=e,a=new Uint8Array(p.buffer,e.cells_ptr,r*n),j=0;for(let l=0;l<r;l++)for(let c=0;c<n;c++){let d=a[j];(!t||d&2)&&A(l,c,d&1),j++}},z=e=>{let A=e.getImageData(0,0,e.canvas.width,e.canvas.height),t=new Int32Array(A.data.buffer),r=w(Z);for(let n=0;n<e.canvas.width;n+=o)for(let a=0;a<e.canvas.height;a++)t[a*e.canvas.width+n]=r;for(let n=0;n<e.canvas.height;n+=o)for(let a=0;a<e.canvas.width;a++)t[n*e.canvas.width+a]=r;e.putImageData(A,0,0)},jA=(e,A)=>{e.width=o*A.column_count+1,e.height=o*A.row_count+1;let t=e.getContext("2d");z(t);let r=J(f),n=J(E),a=(j,l,c)=>{t.fillStyle=c?n:r,t.fillRect(l*o+1,j*o+1,m,m)};return b(A,a),y(()=>{A.tick(),b(A,a,!0)})},oA=(e,A)=>{e.width=o*A.column_count+1,e.height=o*A.row_count+1;let t=e.getContext("2d");z(t);let r=t.getImageData(0,0,e.width,e.height),n=new Int32Array(r.data.buffer),a=(d,h,q,Q,Y)=>{let x=d+h*e.width;for(let k=0;k<Q;k++){for(let g=0;g<q;g++)n[x+g]=Y;x+=e.width}},j=w(f),l=w(E),c=(d,h,q)=>{a(h*o+1,d*o+1,m,m,q?l:j)};return b(A,c),y(()=>{t.putImageData(r,0,0),A.tick(),b(A,c,!0)})},P=(e,A)=>{let t=new _(A.as_ptr,m,w(Z),w(f),w(E)),r=new ImageData(new Uint8ClampedArray(p.buffer,t.data_ptr,t.width*t.height*4),t.width,t.height);e.width=t.width,e.height=t.height;let n=e.getContext("2d");return t.draw_cells(!1),y(()=>{n.putImageData(r,0,0),A.tick(),t.draw_cells(!0)})};{let e=document.body.appendChild(document.createElement("canvas")),A=new u(200,200);A.random();let{stop:t}=P(e,A),r=()=>(e.remove(),e.width=0,e.height=0,e=document.body.appendChild(document.createElement("canvas"))),n=i.appendChild(document.createElement("div"));n.innerHTML=`
    <fieldset>
      <legend style="padding:0 8px">Renderer</legend>
      <label style="cursor:pointer"><input type="radio" name="renderer">Stop</label><br>
      <label style="cursor:pointer"><input type="radio" name="renderer" value="canvas-api">fillRect (JS)</label><br>
      <label style="cursor:pointer"><input type="radio" name="renderer" value="image-data">putImageData (JS)</label><br>
      <label style="cursor:pointer"><input type="radio" name="renderer" value="wasm" checked>putImageData (WASM)</label><br>
    </fieldset>
    <fieldset>
      <legend style="padding:0 8px">Vastness</legend>
      <label style="cursor:pointer"><input type="radio" name="vastness" value="200" checked>200x200</label><br>
      <label style="cursor:pointer"><input type="radio" name="vastness" value="400">400x400</label><br>
      <label style="cursor:pointer"><input type="radio" name="vastness" value="600">600x600</label><br>
      <label style="cursor:pointer"><input type="radio" name="vastness" value="800">800x800</label><br>
    </fieldset>
  `,n.addEventListener("change",a=>{if(a.target instanceof HTMLInputElement){if(t(),a.target.name==="vastness"){let j=+a.target.value;A=new u(j,j),A.random()}switch(n.querySelector("[name=renderer]:checked").value){case"canvas-api":({stop:t}=jA(r(),A));break;case"image-data":({stop:t}=oA(r(),A));break;case"wasm":({stop:t}=P(r(),A));break;default:t=()=>{};break}}})}
