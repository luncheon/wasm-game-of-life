var M="./wasm_game_of_life_bg.wasm";var ae=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder,F=new ae("utf-8",{ignoreBOM:!0,fatal:!0});F.decode();var x=null;function se(){return(x===null||x.buffer!==f.buffer)&&(x=new Uint8Array(f.buffer)),x}function oe(A,e){return F.decode(se().subarray(A,A+e))}var h=class{static __wrap(e){let t=Object.create(h.prototype);return t.ptr=e,t}__destroy_into_raw(){let e=this.ptr;return this.ptr=0,e}free(){let e=this.__destroy_into_raw();L(e)}constructor(e,t){var r=R(e,t);return h.__wrap(r)}random(){O(this.ptr)}single_space_ship(e,t){T(this.ptr,e,t)}get as_ptr(){var e=S(this.ptr);return e}get cells_ptr(){var e=G(this.ptr);return e}get row_count(){var e=H(this.ptr);return e>>>0}get column_count(){var e=U(this.ptr);return e>>>0}set_cell_alive(e,t,r){N(this.ptr,e,t,r)}tick(){W(this.ptr)}},g=class{static __wrap(e){let t=Object.create(g.prototype);return t.ptr=e,t}__destroy_into_raw(){let e=this.ptr;return this.ptr=0,e}free(){let e=this.__destroy_into_raw();P(e)}constructor(e,t,r,n,a){var u=Y(e,t,r,n,a);return g.__wrap(u)}get width(){var e=V(this.ptr);return e>>>0}get height(){var e=X(this.ptr);return e>>>0}get data_ptr(){var e=J(this.ptr);return e}draw_cells(e){Z(this.ptr,e)}};function D(){var A=Date.now();return A}function K(A,e){throw new Error(oe(A,e))}var ie={["./wasm_game_of_life_bg.js"]:{__wbg_now_c3277d0b8a8f625b:D,__wbindgen_throw:K}};async function ce(A,e){if(typeof A=="string"){let t=await fetch(A);if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(r){if(t.headers.get("Content-Type")!="application/wasm")console.warn(r);else throw r}A=await t.arrayBuffer()}return await WebAssembly.instantiate(A,e)}var{instance:o,module:be}=await ce(M,ie),f=o.exports.memory,L=o.exports.__wbg_universe_free,R=o.exports.universe_new,O=o.exports.universe_random,T=o.exports.universe_single_space_ship,S=o.exports.universe_as_ptr,G=o.exports.universe_cells_ptr,H=o.exports.universe_row_count,U=o.exports.universe_column_count,N=o.exports.universe_set_cell_alive,W=o.exports.universe_tick,P=o.exports.__wbg_universecanvasdrawer_free,Y=o.exports.universecanvasdrawer_new,V=o.exports.universecanvasdrawer_width,X=o.exports.universecanvasdrawer_height,J=o.exports.universecanvasdrawer_data_ptr,Z=o.exports.universecanvasdrawer_draw_cells;var m=document.body.appendChild(document.createElement("aside"));m.style.position="fixed";m.style.top="16px";m.style.right="16px";m.style.padding="4px";m.style.background="rgba(255,255,255,.8)";m.style.whiteSpace="nowrap";m.style.userSelect="none";var v=3,_=v+1,Q=[204,204,204],I=[255,255,255],B=[0,0,0],z=([A,e,t])=>`rgb(${A},${e},${t})`,q=([A,e,t])=>(255<<24)+(t<<16)+(e<<8)+A,le=(()=>{let A=m.appendChild(document.createElement("div"));A.style.float="right",A.style.color="hsl(150,100%,50%)",A.style.textShadow="1px 1px 1px hsl(150,100%,20%)",A.style.fontVariantNumeric="tabular-nums",A.textContent="0 fps";let e=0,t=performance.now();return setInterval(()=>{let r=performance.now();A.textContent=`${Math.round(e*1e3/(r-t))} fps`,e=0,t=r},512),()=>e++})(),ue=A=>{let e,t=()=>{A(),le(),e=requestAnimationFrame(t)};return t(),{stop:()=>e!==void 0&&cancelAnimationFrame(e)}},k=(A,e,t)=>{let{row_count:r,column_count:n}=A,a=new Uint8Array(f.buffer,A.cells_ptr,r*n),u=0;for(let i=0;i<r;i++)for(let c=0;c<n;c++){let d=a[u];(!t||d&2)&&e(i,c,d&1),u++}},ee=A=>{let e=A.getImageData(0,0,A.canvas.width,A.canvas.height),t=new Int32Array(e.data.buffer),r=q(Q);for(let n=0;n<A.canvas.width;n+=_)for(let a=0;a<A.canvas.height;a++)t[a*A.canvas.width+n]=r;for(let n=0;n<A.canvas.height;n+=_)for(let a=0;a<A.canvas.width;a++)t[n*A.canvas.width+a]=r;A.putImageData(e,0,0)},de=(A,e)=>{A.width=_*e.column_count+1,A.height=_*e.row_count+1;let t=A.getContext("2d");ee(t);let r=z(I),n=z(B),a=(u,i,c)=>{t.fillStyle=c?n:r,t.fillRect(i*_+1,u*_+1,v,v)};return k(e,a),()=>k(e,a,!0)},_e=(A,e)=>{A.width=_*e.column_count+1,A.height=_*e.row_count+1;let t=A.getContext("2d");ee(t);let r=t.getImageData(0,0,A.width,A.height),n=new Int32Array(r.data.buffer),a=(d,s,j,l,b)=>{let p=d+s*A.width;for(let E=0;E<l;E++){for(let w=0;w<j;w++)n[p+w]=b;p+=A.width}},u=q(I),i=q(B),c=(d,s,j)=>{a(s*_+1,d*_+1,v,v,j?i:u)};return k(e,c),t.putImageData(r,0,0),()=>{k(e,c,!0),t.putImageData(r,0,0)}},pe=(A,e)=>{let t=new g(e.as_ptr,v,q(Q),q(I),q(B)),r=new ImageData(new Uint8ClampedArray(f.buffer,t.data_ptr,t.width*t.height*4),t.width,t.height);A.width=t.width,A.height=t.height;let n=A.getContext("2d");return t.draw_cells(!1),n.putImageData(r,0,0),()=>{t.draw_cells(!1),n.putImageData(r,0,0)}};{let A=document.body.appendChild(document.createElement("canvas")),e=new h(200,200);e.random();let t=s=>Math.min(Math.floor(s),e.row_count-1),r=s=>Math.min(Math.floor(s),e.column_count-1),n=(s,j)=>{let l=A.getBoundingClientRect(),b=(s-l.x-1)*A.width/l.width,p=(j-l.y-1)*A.height/l.height;return[t(p/(v+1)),r(b/(v+1))]};addEventListener("pointerdown",s=>{if(s.target===A){let[j,l]=n(s.clientX,s.clientY);e.set_cell_alive(j,l,!0),i();let b=E=>{let[w,$]=n(E.clientX,E.clientY),Ae=Math.hypot(w-j,$-l),C=Math.atan2(w-j,$-l),te=Math.sin(C),re=Math.cos(C);for(let y=0;y<Ae;y++)e.set_cell_alive(t(j+y*te),r(l+y*re),!0);e.set_cell_alive(j,l,!0),j=w,l=$,i()},p=()=>{removeEventListener("pointerup",p),removeEventListener("pointercancel",p),removeEventListener("pointermove",b),d()};addEventListener("pointerup",p),addEventListener("pointercancel",p),addEventListener("pointermove",b),c()}});let a=()=>(A.remove(),A.width=0,A.height=0,A=document.body.appendChild(document.createElement("canvas")),A.style.cursor="crosshair",A),u=m.appendChild(document.createElement("div"));u.innerHTML=`
    <fieldset>
      <legend style="padding:0 8px">Renderer</legend>
      <label style="cursor:pointer"><input type="radio" name="renderer">Stop</label><br>
      <label style="cursor:pointer"><input type="radio" name="renderer" value="canvas-api">fillRect (JS)</label><br>
      <label style="cursor:pointer"><input type="radio" name="renderer" value="image-data">putImageData (JS)</label><br>
      <label style="cursor:pointer"><input type="radio" name="renderer" value="wasm" checked>putImageData (WASM)</label><br>
    </fieldset>
    <fieldset>
      <legend style="padding:0 8px">Vastness</legend>
      <label style="cursor:pointer"><input type="radio" name="vastness" value="200" checked>200x200</label><br>
      <label style="cursor:pointer"><input type="radio" name="vastness" value="400">400x400</label><br>
      <label style="cursor:pointer"><input type="radio" name="vastness" value="600">600x600</label><br>
      <label style="cursor:pointer"><input type="radio" name="vastness" value="800">800x800</label><br>
    </fieldset>
  `,u.addEventListener("change",s=>{if(s.target instanceof HTMLInputElement){if(c(),s.target.name==="vastness"){let j=+s.target.value;e=new h(j,j),e.random()}d()}});let i,c,d=()=>{switch(u.querySelector("[name=renderer]:checked").value){case"canvas-api":i=de(a(),e);break;case"image-data":i=_e(a(),e);break;case"wasm":i=pe(a(),e);break;default:c=()=>{};return}({stop:c}=ue(()=>{e.tick(),i()}))};d()}
