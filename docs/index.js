var M="./wasm_game_of_life_bg.wasm";var AA=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder,G=new AA("utf-8",{ignoreBOM:!0,fatal:!0});G.decode();var b=null;function eA(){return(b===null||b.buffer!==d.buffer)&&(b=new Uint8Array(d.buffer)),b}function tA(e,A){return G.decode(eA().subarray(e,e+A))}var l=class{static __wrap(A){let t=Object.create(l.prototype);return t.ptr=A,t}__destroy_into_raw(){let A=this.ptr;return this.ptr=0,A}free(){let A=this.__destroy_into_raw();$(A)}constructor(A,t){var r=K(A,t);return l.__wrap(r)}random(){O(this.ptr)}single_space_ship(A,t){C(this.ptr,A,t)}get as_ptr(){var A=N(this.ptr);return A}get cells_ptr(){var A=D(this.ptr);return A}get row_count(){var A=P(this.ptr);return A>>>0}get column_count(){var A=L(this.ptr);return A>>>0}tick(){T(this.ptr)}},u=class{static __wrap(A){let t=Object.create(u.prototype);return t.ptr=A,t}__destroy_into_raw(){let A=this.ptr;return this.ptr=0,A}free(){let A=this.__destroy_into_raw();R(A)}constructor(A,t,r,j,n){var s=S(A,t,r,j,n);return u.__wrap(s)}get width(){var A=H(this.ptr);return A>>>0}get height(){var A=U(this.ptr);return A>>>0}get data_ptr(){var A=W(this.ptr);return A}draw(){Q(this.ptr)}};function F(){var e=Date.now();return e}function B(e,A){throw new Error(tA(e,A))}var jA={["./wasm_game_of_life_bg.js"]:{__wbg_now_c3277d0b8a8f625b:F,__wbindgen_throw:B}};async function nA(e,A){if(typeof e=="string"){let t=await fetch(e);if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,A)}catch(r){if(t.headers.get("Content-Type")!="application/wasm")console.warn(r);else throw r}e=await t.arrayBuffer()}return await WebAssembly.instantiate(e,A)}var{instance:a,module:dA}=await nA(M,jA),d=a.exports.memory,$=a.exports.__wbg_universe_free,K=a.exports.universe_new,O=a.exports.universe_random,C=a.exports.universe_single_space_ship,N=a.exports.universe_as_ptr,D=a.exports.universe_cells_ptr,P=a.exports.universe_row_count,L=a.exports.universe_column_count,T=a.exports.universe_tick,R=a.exports.__wbg_universecanvasdrawer_free,S=a.exports.universecanvasdrawer_new,H=a.exports.universecanvasdrawer_width,U=a.exports.universecanvasdrawer_height,W=a.exports.universecanvasdrawer_data_ptr,Q=a.exports.universecanvasdrawer_draw;var i=document.body.appendChild(document.createElement("aside"));i.style.position="fixed";i.style.top="16px";i.style.right="16px";i.style.padding="4px";i.style.background="rgba(255,255,255,.8)";i.style.whiteSpace="nowrap";i.style.userSelect="none";var _=3,o=_+1,Z=[204,204,204],E=[255,255,255],y=[0,0,0],V=([e,A,t])=>`rgb(${e},${A},${t})`,p=([e,A,t])=>(255<<24)+(t<<16)+(A<<8)+e,aA=(()=>{let e=i.appendChild(document.createElement("div"));e.style.float="right",e.style.color="hsl(150,100%,50%)",e.style.textShadow="1px 1px 1px hsl(150,100%,20%)",e.style.fontVariantNumeric="tabular-nums",e.textContent="0 fps";let A=0,t=performance.now();return setInterval(()=>{let r=performance.now();e.textContent=`${Math.round(A*1e3/(r-t))} fps`,A=0,t=r},512),()=>A++})(),I=e=>{let A,t=()=>{e(),aA(),A=requestAnimationFrame(t)};return t(),{stop:()=>A!==void 0&&cancelAnimationFrame(A)}},z=(e,A)=>{let{row_count:t,column_count:r}=e,j=new Uint8Array(d.buffer,e.cells_ptr,t*r),n=0;for(let s=0;s<t;s++)for(let c=0;c<r;c++)A(s,c,j[n]),n++},Y=e=>{let A=e.getImageData(0,0,e.canvas.width,e.canvas.height),t=new Int32Array(A.data.buffer),r=p(Z);for(let j=0;j<e.canvas.width;j+=o)for(let n=0;n<e.canvas.height;n++)t[n*e.canvas.width+j]=r;for(let j=0;j<e.canvas.height;j+=o)for(let n=0;n<e.canvas.width;n++)t[j*e.canvas.width+n]=r;e.putImageData(A,0,0)},sA=(e,A)=>{e.width=o*A.column_count+1,e.height=o*A.row_count+1;let t=e.getContext("2d");Y(t);let r=V(E),j=V(y),n=()=>{z(A,(s,c,k)=>{t.fillStyle=k?j:r,t.fillRect(c*o+1,s*o+1,_,_)})};return I(()=>{n(),A.tick()})},oA=(e,A)=>{e.width=o*A.column_count+1,e.height=o*A.row_count+1;let t=e.getContext("2d");Y(t);let r=t.getImageData(0,0,e.width,e.height),j=new Int32Array(r.data.buffer),n=(h,g,f,v,m)=>{let w=h+g*e.width;for(let x=0;x<v;x++){for(let q=0;q<f;q++)j[w+q]=m;w+=e.width}},s=p(E),c=p(y),k=()=>{z(A,(h,g,f)=>{let v=f?c:s,m=g*o+1,w=h*o+1;j[m+w*e.width]!==v&&n(m,w,_,_,v)}),t.putImageData(r,0,0)};return I(()=>{k(),A.tick()})},J=(e,A)=>{let t=new u(A.as_ptr,_,p(Z),p(E),p(y)),r=new ImageData(new Uint8ClampedArray(d.buffer,t.data_ptr,t.width*t.height*4),t.width,t.height);e.width=t.width,e.height=t.height;let j=e.getContext("2d");return I(()=>{t.draw(),j.putImageData(r,0,0),A.tick()})};{let e=document.body.appendChild(document.createElement("canvas")),A=new l(200,200);A.random();let{stop:t}=J(e,A),r=()=>(e.remove(),e.width=0,e.height=0,e=document.body.appendChild(document.createElement("canvas"))),j=i.appendChild(document.createElement("div"));j.innerHTML=`
    <fieldset>
      <legend style="padding:0 8px">Renderer</legend>
      <label style="cursor:pointer"><input type="radio" name="renderer">Stop</label><br>
      <label style="cursor:pointer"><input type="radio" name="renderer" value="canvas-api">fillRect (JS)</label><br>
      <label style="cursor:pointer"><input type="radio" name="renderer" value="image-data">putImageData (JS)</label><br>
      <label style="cursor:pointer"><input type="radio" name="renderer" value="wasm" checked>putImageData (WASM)</label><br>
    </fieldset>
    <fieldset>
      <legend style="padding:0 8px">Vastness</legend>
      <label style="cursor:pointer"><input type="radio" name="vastness" value="200" checked>200x200</label><br>
      <label style="cursor:pointer"><input type="radio" name="vastness" value="400">400x400</label><br>
      <label style="cursor:pointer"><input type="radio" name="vastness" value="600">600x600</label><br>
      <label style="cursor:pointer"><input type="radio" name="vastness" value="800">800x800</label><br>
    </fieldset>
  `,j.addEventListener("change",n=>{if(n.target instanceof HTMLInputElement){if(t(),n.target.name==="vastness"){let s=+n.target.value;A=new l(s,s),A.random()}switch(j.querySelector("[name=renderer]:checked").value){case"canvas-api":({stop:t}=sA(r(),A));break;case"image-data":({stop:t}=oA(r(),A));break;case"wasm":({stop:t}=J(r(),A));break;default:t=()=>{};break}}})}
